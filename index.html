<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบเช็คชื่อนักเรียน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    
    <link rel="stylesheet" href="style.css">
    <script type="module" src="script.js"></script>
</head>
<body>
    <div id="app-container">
        <div class="sticky top-0 z-50 bg-white shadow-sm">
            <div class="flex items-center justify-between p-4">
                <div class="text-xl font-semibold text-gray-800" id="header-title">เช็คชื่อ</div>
                <div class="flex items-center space-x-3">
                    <label for="date-picker-input-trigger" id="date-selector-display" class="text-sm text-blue-500 font-medium cursor-pointer">
                        <span id="current-date"></span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </label>
                    <button id="admin-login-status-btn" class="text-sm text-gray-600 font-medium px-3 py-1 rounded-full hover:bg-gray-100 transition" onclick="handleAdminStatusClick()">
                        เข้าสู่ระบบ
                    </button>

                </div>
            </div>
        </div>

        <div class="container mx-auto">
            <div id="attendance-page" class="page active">                
                <div class="ios-card p-4 mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <h2 class="text-lg font-semibold text-gray-800">สรุปการมาเรียนวันนี้</h2>
                        <button id="refresh-stats" class="text-blue-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="stat-card" id="present-stat-card">
                            <div class="text-sm opacity-80">มาเรียน</div>
                            <div class="flex items-end justify-between">
                                <div class="text-2xl font-bold" id="present-count">0</div>
                                <div class="text-lg" id="present-percent">0%</div>
                            </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #ff3b30, #ff9500);">
                            <div class="text-sm opacity-80">ขาดเรียน</div>
                            <div class="flex items-end justify-between">
                                <div class="text-2xl font-bold" id="absent-count">0</div>
                                <div class="text-lg" id="absent-percent">0%</div>
                            </div>
                        </div>
                    </div>
                        <div class="grid">
                            <div class="sub-stat-item">
                                <div class="text-xs" id="classes-checked-display">ห้องที่เช็คชื่อแล้ว 0/0 ห้อง</div>
                                <div class="progress-bar-container"><div id="classes-checked-progress" class="progress-bar green"></div></div>
                            </div>
                            <div class="sub-stat-item">
                                <div class="text-xs" id="total-days-attended-overall">จำนวนวันเปิดเรียน(เทอมนี้) 0 วัน</div>
                                <div class="progress-bar-container"><div id="total-days-progress" class="progress-bar blue"></div></div>
                            </div>
                        </div>

                        <script>
                            document.addEventListener('DOMContentLoaded', () => {
                                const classesCheckedDisplay = document.getElementById('classes-checked-display');
                                const totalDaysAttendedOverallDisplay = document.getElementById('total-days-attended-overall');
                                if (classesCheckedDisplay) {
                                    classesCheckedDisplay.textContent = `ห้องที่เช็คชื่อแล้ว 0/0 ห้อง`;
                                }
                                if (totalDaysAttendedOverallDisplay) {
                                    totalDaysAttendedOverallDisplay.textContent = `จำนวนวันเปิดเรียน(เทอมนี้) 0 วัน`;
                                }
                            });
                        </script>

                </div>
                
                <div class="ios-card mb-4">
                    <div class="flex justify-between items-center p-4" id="class-selection-header">
                        <h2 class="text-lg font-semibold text-gray-800">เลือกห้องเรียนเพื่อเช็คชื่อ</h2>
                        </div>
                    <div class="active" id="class-selection-content">
                        <div class="px-4 pb-4">
                            <div class="grid grid-cols-1 gap-3" id="class-list-attendance">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="savings-page" class="page">
                <div class="ios-card p-4 mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3">สรุปการออมเงิน (ปีการศึกษา <span id="savings-academic-year-display"></span>)</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50, #8BC34A);">
                            <div class="text-sm opacity-80">ยอดออมรวม</div>
                            <div class="text-2xl font-bold" id="total-savings-amount">฿ 0</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #FFC107, #FFEB3B);">
                            <div class="text-sm opacity-80">นักเรียนที่ออม</div>
                            <div class="text-2xl font-bold" id="students-saving-count">0 <span class="text-lg">คน</span></div>
                        </div>
                    </div>
                </div>
                <div class="ios-card mb-4 p-4">
                    <label for="savings-class-filter" class="block text-sm font-medium text-gray-700 mb-1">เลือกห้องเพื่อดูรายการ/บันทึก</label>
                    <select id="savings-class-filter" class="ios-select w-full mb-3">
                        <option value="all">ทุกห้องเรียน</option>
                    </select>
                    <button id="add-new-saving-btn" class="ios-button w-full text-sm py-2 px-3 admin-only-item">บันทึกการออมใหม่</button>
                </div>
                <div class="ios-card mb-4">
                    <div class="p-4 border-b border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-800">รายการออมเงิน</h2>
                    </div>
                    <div id="savings-list" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                        <div class="p-4 text-center text-gray-500">ไม่มีข้อมูลการออม</div>
                    </div>
                </div>
            </div>

            <div id="health-page" class="page">
                <div class="ios-card p-4 mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3">สรุปสุขภาพนักเรียน (ปีการศึกษา <span id="health-academic-year-display"></span>)</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="stat-card" style="background: linear-gradient(135deg, #00C853, #69F0AE);">
                            <div class="text-sm opacity-80">สุขภาพปกติ</div>
                            <div class="text-2xl font-bold" id="health-normal-count">0 <span class="text-lg">คน</span></div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #D50000, #FF1744);">
                            <div class="text-sm opacity-80">ต้องเฝ้าระวัง</div>
                            <div class="text-2xl font-bold" id="health-watchout-count">0 <span class="text-lg">คน</span></div>
                        </div>
                    </div>
                </div>
                 <div class="ios-card mb-4 p-4">
                    <label for="health-class-filter" class="block text-sm font-medium text-gray-700 mb-1">เลือกห้องเพื่อดูรายการ/บันทึก</label>
                    <select id="health-class-filter" class="ios-select w-full mb-3">
                        <option value="all">ทุกห้องเรียน</option>
                    </select>
                    <button id="add-new-health-record-btn" class="ios-button w-full text-sm py-2 px-3 admin-only-item">บันทึกสุขภาพใหม่</button>
                </div>
                <div class="ios-card mb-4">
                     <div class="p-4 border-b border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-800">รายการสุขภาพ</h2>
                    </div>
                    <div id="health-list" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                         <div class="p-4 text-center text-gray-500">ไม่มีข้อมูลสุขภาพ</div>
                    </div>
                </div>
            </div>
            
            <div id="history-page-content" class="hidden p-4">
                <div class="ios-card mb-4">
                    <div class="p-4">
                        <h2 class="text-lg font-semibold text-gray-800 mb-3">ประวัติการเข้าเรียน (ปีการศึกษา <span class="current-year-in-subpage"></span>)</h2>
                        <div class="flex space-x-2 mb-4">
                            <select id="history-class-filter" class="ios-select flex-1">
                                <option value="all">ทุกชั้นเรียน</option>
                            </select>
                            <select id="history-month-filter" class="ios-select flex-1">
                            </select>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-3 mb-3">
                            <div class="text-sm text-gray-500">อัตราการมาเรียนเฉลี่ย</div>
                            <div class="mt-1 text-xl font-medium" id="average-attendance-rate">0%</div>
                        </div>
                        <div class="h-64">
                            <canvas id="attendance-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="ios-card">
                    <div class="p-4 border-b border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-800">รายละเอียดการเข้าเรียน</h2>
                    </div>
                    <div id="attendance-history-list" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                        </div>
                </div>
            </div>

            <div id="report-page-content" class="hidden p-4">
                <div class="ios-card mb-4">
                    <div class="p-4">
                        <h2 class="text-lg font-semibold text-gray-800 mb-3">รายงานการมาเรียน (ปีการศึกษา <span class="current-year-in-subpage"></span>)</h2>
                        <div class="flex space-x-2 mb-4">
                            <select id="report-class-filter" class="ios-select flex-1">
                                <option value="all">ทุกชั้นเรียน</option>
                            </select>
                            <select id="report-type-filter" class="ios-select flex-1">
                                <option value="daily">รายงานรายวัน</option>
                                </select>
                        </div>
                        
                        <div class="flex justify-between items-center mb-3">
                            <div class="text-sm text-gray-500">วันที่: <span id="report-date" class="font-medium"></span></div>
                            <button id="export-csv-btn" class="flex items-center text-sm text-green-600 font-medium admin-only-item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                CSV
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 rounded-xl p-3 mb-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <div class="text-sm text-gray-500">มาเรียน</div>
                                    <div class="mt-1 text-xl font-medium text-green-600" id="report-present-count">0 (0%)</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-500">ขาดเรียน</div>
                                    <div class="mt-1 text-xl font-medium text-red-600" id="report-absent-count">0 (0%)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ios-card">
                    <div class="p-4 border-b border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-800">รายละเอียดรายงาน</h2>
                    </div>
                    <div id="report-details" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                        </div>
                </div>
            </div>

            <div id="profile-page" class="page">
                <div id="profile-main-content">
                    <div class="ios-card mb-4 p-4">
                        <div class="flex items-center mb-3">
                            <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mr-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-lg font-semibold text-gray-800" id="teacher-name-display">ผู้ชม</h2>
                                <div class="text-sm text-gray-500" id="teacher-id-display">รหัส: -</div>
                                <div class="text-sm text-gray-500" id="current-academic-year-display">ปีการศึกษา: <span class="current-year-in-subpage"></span></div>
                            </div>
                        </div>
                         <div class="space-y-2 mt-3">
                            <button id="change-password-btn" class="ios-button w-full ios-button-gray admin-only-item">เปลี่ยนรหัสผ่าน</button>
                        </div>
                    </div>
                    
                    <div class="ios-card mb-4 admin-only-item" >
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">ข้อมูลและการรายงาน</h2>
                        </div>
                         <div class="p-4 flex flex-col space-y-3">
                            <button id="show-history-btn" class="ios-button w-full ios-button-gray">ดูประวัติการเข้าเรียน</button>
                            <button id="show-report-btn" class="ios-button w-full ios-button-gray">ดูรายงาน</button>
                            <button id="manage-students-by-teacher-btn" class="ios-button w-full ios-button-gray admin-only-item">จัดการข้อมูลนักเรียน</button>
                        </div>
                    </div>

                    <div class="ios-card mb-4 viewer-only-item" >
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">การขอรหัสผ่านผู้ใช้</h2>
                        </div>
                        <div class="p-4 flex flex-col space-y-3">
                            <div class="text-l text-gray-600">
                                <p>1. กดเข้าสู่ระบบด้วย Gmail เพื่อขอรหัสผ่านผู้ใช้</p>
                                <p>2. ติดต่อผู้ดูแล เพื่ออนุญาตการเข้าถึงระบบ</p>
                                <p>ปุ่มติดต่อผู้ดูแล</p>
                            </div>
                        </div>
                    </div>

                    <div class="ios-card mb-4" >
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">ข้อแนะนําในการใช้ระบบ</h2>
                        </div>
                         <div class="p-4 flex flex-col space-y-3">
                            <div class="text-l text-gray-600">
                                <p>1. เลือกวันที่ที่ต้องการเช็คชื่อจากปฏิทินด้านบน</p>
                                <p>2. เลือกห้องเรียนที่ต้องการเช็คชื่อ</p>
                                <p>3. เช็คชื่อนักเรียนโดยคลิกที่ปุ่ม "มาเรียน" หรือ"ขาดเรียน"</p>
                                <p>4. สามารถดูสรุปการมาเรียนและรายงานได้ในหน้า "รายงาน"</p>
                            </div>
                        </div>
                    </div>

                    <div id="admin-settings-section" class="hidden">
                         <div class="ios-card mb-4">
                            <div class="p-4 border-b border-gray-100">
                                <h2 class="text-lg font-semibold text-gray-800">จัดการข้อมูลนักเรียน</h2>
                            </div>
                            <div class="p-4 flex flex-col space-y-3">
                                <button id="legacy-add-student-btn" class="ios-button w-full ios-button-gray admin-only-item">เพิ่มนักเรียนใหม่ (Legacy)</button> <!-- ID changed -->
                                <button id="legacy-import-student-btn" class="ios-button w-full ios-button-gray admin-only-item">นำเข้าข้อมูลนักเรียน (Legacy)</button> <!-- ID changed -->
                                <button id="legacy-download-template-btn" class="ios-button w-full ios-button-gray admin-only-item">ดาวน์โหลดเทมเพลต (Legacy)</button> <!-- ID changed -->
                                <button id="delete-all-students-btn" class="ios-button w-full text-red-600 admin-only-item">ลบรายชื่อนักเรียนทั้งหมด</button>
                            </div>
                        </div>

                        <div class="ios-card mb-4">
                            <div class="p-4 border-b border-gray-100">
                                <h2 class="text-lg font-semibold text-gray-800">จัดการข้อมูลนักเรียน (Admin)</h2>
                            </div>
                            <div class="p-4 flex flex-col space-y-3">
                                <button id="add-student-btn" class="ios-button w-full ios-button-gray flex items-center justify-center admin-only-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                    </svg>
                                    เพิ่มนักเรียนใหม่
                                </button>
                                <button id="import-student-btn" class="ios-button w-full ios-button-gray flex items-center justify-center admin-only-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                    </svg>
                                    นำเข้าข้อมูลนักเรียน
                                </button>
                                <button id="download-template-btn" class="ios-button w-full ios-button-gray flex items-center justify-center admin-only-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    ดาวน์โหลดเทมเพลต
                                </button>
                            </div>
                        </div>

                        <div class="ios-card mb-4">
                            <div class="p-4 border-b border-gray-100">
                                <h2 class="text-lg font-semibold text-gray-800">Admin Controls</h2>
                            </div>
                            <div class="p-4 flex flex-col space-y-3">
                                <button id="manage-users-btn" class="ios-button w-full ios-button-gray admin-only-item">จัดการผู้ใช้งาน</button>
                                <button id="manage-classes-btn" class="ios-button w-full ios-button-gray admin-only-item">จัดการชั้นเรียน</button>
                                <button id="open-system-settings-modal-btn" class="ios-button w-full ios-button-gray admin-only-item">ตั้งค่าระบบ</button>
                            </div>
                        </div>


                    </div>
                    
                    <div class="mb-4">
                        <button id="save-profile-btn" class="ios-button w-full admin-only-item">บันทึกข้อมูล</button>
                    </div>
                </div> </div>
        </div>

        <div class="ios-modal" id="admin-actions-modal">
            <div class="ios-modal-content">
                 <h3 class="text-lg font-semibold text-gray-800 mb-4">การดำเนินการผู้ดูแล</h3>
                 <button id="admin-logout-btn" class="ios-button w-full bg-red-500 hover:bg-red-700">ออกจากระบบผู้ดูแล</button>
                 <button class="ios-button w-full mt-3 bg-gray-300 hover:bg-gray-400 text-gray-800 close-modal-btn">ยกเลิก</button>
            </div>
        </div>

        <div class="ios-modal" id="manage-users-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">จัดการผู้ใช้งาน</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <h4 class="text-md font-semibold text-gray-700 mb-2">รายชื่อผู้ใช้งาน</h4>
                <div id="user-list-display" class="text-sm text-gray-600 max-h-40 overflow-y-auto mb-4">
                    </div>
                <button id="add-new-user-btn-main" class="ios-button w-full mt-4 admin-only-item">เพิ่มผู้ใช้งาน</button>
            </div>
        </div>
        
        <div class="ios-modal" id="user-form-modal"> <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="user-form-modal-title">เพิ่ม/แก้ไขผู้ใช้งาน</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <input type="hidden" id="user-form-mode"> <input type="hidden" id="editing-user-id-hidden"> <div class="space-y-3">
                    <div class="profile-input-group">
                        <label for="user-form-id-input">รหัสผู้ใช้งาน</label>
                        <input type="text" id="user-form-id-input" class="ios-input w-full" placeholder="รหัสผู้ใช้งาน" >
                    </div>
                    <div class="profile-input-group">
                        <label for="user-form-password-input">รหัสผ่าน (เว้นว่างถ้าไม่ต้องการเปลี่ยน)</label>
                        <input type="password" id="user-form-password-input" class="ios-input w-full" placeholder="รหัสผ่าน">
                    </div>
                    <div class="profile-input-group">
                        <label for="user-form-role-select">บทบาท</label>
                        <select id="user-form-role-select" class="ios-select w-full">
                            <option value="user">User (ครูทั่วไป)</option>
                            <option value="admin">Admin (ผู้ดูแลระบบ)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ห้องเรียนที่รับผิดชอบ (เลือกได้หลายห้อง):</label>
                        <div id="user-form-responsible-classes-checkboxes" class="grid grid-cols-2 gap-2 text-sm max-h-40 overflow-y-auto border p-2 rounded-lg bg-gray-50">
                            </div>
                    </div>
                </div>
                <button id="save-user-form-btn" class="ios-button w-full mt-4 admin-only-item">บันทึก</button>
            </div>
        </div>

        <div class="ios-modal" id="change-password-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">เปลี่ยนรหัสผ่าน</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="space-y-3">
                    <input type="password" id="current-password-input" class="ios-input w-full" placeholder="รหัสผ่านปัจจุบัน">
                    <input type="password" id="new-password-input" class="ios-input w-full" placeholder="รหัสผ่านใหม่">
                    <input type="password" id="confirm-new-password-input" class="ios-input w-full" placeholder="ยืนยันรหัสผ่านใหม่">
                </div>
                <button id="save-new-password-btn" class="ios-button w-full mt-4">บันทึกรหัสผ่านใหม่</button>
            </div>
        </div>


        <div class="ios-modal" id="manage-classes-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">จัดการชั้นเรียน</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700 mb-1">ชั้นเรียนปัจจุบัน:</label>
                    <div id="current-class-list-display" class="p-2 bg-gray-100 rounded-md max-h-32 overflow-y-auto text-sm">
                        </div>
                </div>
                <div class="mb-3">
                    <label for="new-class-name-input" class="block text-sm font-medium text-gray-700 mb-1">เพิ่มชั้นเรียนใหม่ (เช่น ม.1/1):</label>
                    <div class="flex space-x-2">
                        <input type="text" id="new-class-name-input" class="ios-input flex-grow" placeholder="ชื่อชั้นเรียน">
                        <button id="add-new-class-btn" class="ios-button text-sm py-2 px-3 admin-only-item">เพิ่ม</button>
                    </div>
                </div>
                </div>
        </div>


        
        <div class="ios-modal" id="attendance-detail-modal">
            <div class="ios-modal-content full-screen">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="attendance-detail-modal-title">รายละเอียดการเข้าเรียนห้อง ...</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="attendance-detail-modal-student-list" class="divide-y divide-gray-100 overflow-y-auto" style="max-height: calc(90vh - 120px);">
                    </div>
            </div>
        </div>


        <div class="ios-modal" id="attendance-check-modal">
            <div class="ios-modal-content full-screen">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="attendance-modal-class-title">เช็คชื่อนักเรียน</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="ios-segmented-control mb-4" id="attendance-modal-gender-segment">
                    <div class="ios-segment active" data-gender="male">ชาย</div>
                    <div class="ios-segment" data-gender="female">หญิง</div>
                </div>
                <div class="ios-card mb-4">
                     <div class="flex items-center justify-between p-4 border-b border-gray-100">
                        <div class="text-sm font-medium text-gray-500">รายชื่อนักเรียน (<span id="attendance-modal-student-count">0</span>)</div>
                        <button id="attendance-modal-mark-all-present" class="text-sm text-blue-500 font-medium">เช็คทั้งหมด (ที่แสดง)</button>
                    </div>
                    <div id="attendance-modal-student-list" class="divide-y divide-gray-100 overflow-y-auto" style="max-height: calc(90vh - 220px);">
                        </div>
                    </div>
                <button id="save-attendance-modal-btn" class="ios-button w-full">บันทึกการเช็คชื่อ</button>
            </div>
        </div>
        
        <div class="ios-modal" id="add-student-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">เพิ่มนักเรียนใหม่</h3>
                    <button class="text-gray-500 close-modal-btn">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="space-y-3">
                    <input type="text" id="new-student-id" class="ios-input w-full" placeholder="รหัสนักเรียน">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">เพศ:</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="new-student-gender" value="male" class="form-radio" checked>
                                <span class="ml-2 text-sm">ชาย</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="new-student-gender" value="female" class="form-radio">
                                <span class="ml-2 text-sm">หญิง</span>
                            </label>
                        </div>
                    </div>
                    <select id="new-student-prefix" class="ios-select w-full">
                        </select>
                    <input type="text" id="new-student-firstname" class="ios-input w-full" placeholder="ชื่อ">
                    <input type="text" id="new-student-lastname" class="ios-input w-full" placeholder="นามสกุล">
                    <select id="new-student-class" class="ios-select w-full">
                        <option value="">เลือกชั้นเรียน</option>
                        </select>
                    </div>
                <button id="save-new-student-btn" class="ios-button w-full mt-4 admin-only-item">บันทึกนักเรียน</button>
            </div>
        </div>

        <div class="ios-modal" id="manage-students-by-teacher-modal">
            <div class="ios-modal-content full-screen">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">จัดการข้อมูลนักเรียน (ห้องที่รับผิดชอบ)</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="flex space-x-2 mb-4">
                    <select id="teacher-manage-class-filter" class="ios-select flex-1">
                        <option value="all">ทุกห้องที่รับผิดชอบ</option>
                    </select>
                    <select id="teacher-manage-gender-filter" class="ios-select flex-1">
                        <option value="all">ทุกเพศ</option>
                        <option value="male">ชาย</option>
                        <option value="female">หญิง</option>
                    </select>
                </div>
                <button id="add-student-by-teacher-btn" class="ios-button w-full text-sm py-2 px-3 mb-4 flex items-center justify-center admin-only-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    เพิ่มนักเรียนใหม่ในห้องนี้
                </button>
                <div id="teacher-managed-student-list" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                    <div class="p-4 text-center text-gray-500">ไม่มีนักเรียนในห้องที่รับผิดชอบ</div>
                </div>
            </div>
        </div>

        <div class="ios-modal" id="import-student-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">นำเข้าข้อมูลนักเรียน</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="mb-3">
                    <label for="import-academic-year" class="block text-sm font-medium text-gray-700 mb-1">ปีการศึกษา</label>
                    <select id="import-academic-year" class="ios-select w-full">
                        </select>
                </div>
                <p class="text-sm text-gray-600 mb-2">อัปโหลดไฟล์ CSV/Excel ที่มีข้อมูลนักเรียน</p>
                <input type="file" id="student-file-input" class="ios-input w-full mb-4" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                <button id="confirm-import-student-btn" class="ios-button w-full admin-only-item">นำเข้าข้อมูล</button>
            </div>
        </div>

        <div class="ios-modal" id="download-template-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">ดาวน์โหลดเทมเพลต</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                 <div class="mb-3">
                    <label for="template-academic-year" class="block text-sm font-medium text-gray-700 mb-1">ปีการศึกษา</label>
                    <select id="template-academic-year" class="ios-select w-full">
                         </select>
                </div>
                <div class="space-y-3 mt-3">
                    <a href="#" id="download-student-template-link" class="ios-button w-full flex items-center justify-center" style="background-color: #007aff;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        เทมเพลตนักเรียน (CSV)
                    </a>
                    </div>
            </div>
        </div>
        
        <div class="ios-modal" id="system-settings-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">ตั้งค่าระบบ</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="mb-3">
                    <label for="settings-academic-year-input" class="block text-sm font-medium text-gray-700 mb-1">ปีการศึกษาที่ตั้งค่า:</label>
                    <input type="number" id="settings-academic-year-input" class="ios-input w-full" placeholder="เช่น 2568">
                </div>
                <div class="space-y-3 mt-3 p-3 bg-gray-50 rounded-lg">
                     <h4 class="text-md font-semibold text-gray-700 mb-2">ภาคเรียนที่ 1</h4>
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">วันเปิดภาคเรียนที่ 1</label>
                        <input type="date" id="term1-start-date-input" class="ios-input w-full text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">วันปิดภาคเรียนที่ 1</label>
                        <input type="date" id="term1-end-date-input" class="ios-input w-full text-sm">
                    </div>
                </div>
                <div class="space-y-3 mt-3 p-3 bg-gray-50 rounded-lg">
                     <h4 class="text-md font-semibold text-gray-700 mb-2">ภาคเรียนที่ 2</h4>
                     <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">วันเปิดภาคเรียนที่ 2</label>
                        <input type="date" id="term2-start-date-input" class="ios-input w-full text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">วันปิดภาคเรียนที่ 2</label>
                        <input type="date" id="term2-end-date-input" class="ios-input w-full text-sm">
                    </div>
                </div>
                 <div class="mt-4">
                     <button id="open-holiday-settings-modal-btn" class="ios-button w-full ios-button-gray text-sm">จัดการวันหยุดพิเศษ (สำหรับปีที่เลือก)</button>
                 </div>
                <button id="save-system-settings-btn" class="ios-button w-full mt-6 admin-only-item">บันทึกการตั้งค่าระบบ</button>
            </div>
        </div>
        
        <div class="ios-modal" id="holiday-settings-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">จัดการวันหยุดพิเศษ (ปี <span id="holiday-modal-year-display"></span>)</h3>
                     <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="flex space-x-2 mb-2">
                    <input type="date" id="holiday-date-input" class="ios-input flex-1">
                    <input type="text" id="holiday-description-input" class="ios-input flex-1" placeholder="รายละเอียดวันหยุด">
                    <button id="add-holiday-btn" class="ios-button px-4 py-2 text-sm admin-only-item">เพิ่ม</button>
                </div>
                <div id="holiday-list-display" class="max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-2 space-y-1">
                    </div>
                <div class="flex items-center justify-between mt-4">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="auto-recommend-holidays-toggle" class="form-checkbox h-4 w-4 text-blue-600 rounded">
                        <span class="ml-2 text-sm text-gray-700">เปิดแนะนำอัตโนมัติ</span>
                    </label>
                    <button id="recommend-holidays-ai-btn" class="ios-button ios-button-gray text-sm admin-only-item">แนะนำวันหยุดด้วย AI</button>
                </div>
                <button id="save-holidays-btn" class="ios-button w-full mt-4 admin-only-item">บันทึกวันหยุด</button>
            </div>
        </div>


        <div class="ios-modal" id="add-saving-modal">
            <div class="ios-modal-content">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">บันทึกการออม (<span id="saving-modal-class-name"></span>)</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="space-y-3">
                     <select id="saving-student-select" class="ios-select w-full mb-3">
                        <option value="">เลือกนักเรียน...</option>
                        </select>
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-gray-700">ประเภท:</span>
                        <div class="flex items-center">
                            <span id="saving-type-label-deposit" class="text-sm mr-2 text-green-600 font-semibold">ฝาก</span>
                            <label class="ios-toggle">
                                <input type="checkbox" id="saving-type-toggle">
                                <span class="ios-toggle-slider"></span>
                            </label>
                            <span id="saving-type-label-withdraw" class="text-sm ml-2 text-gray-500">ถอน</span>
                        </div>
                    </div>
                    <input type="date" id="saving-date-input" class="ios-input w-full">
                    <input type="number" id="saving-amount-input" class="ios-input w-full" placeholder="จำนวนเงิน (บาท)">
                </div>
                <button id="save-new-saving-btn" class="ios-button w-full mt-4 admin-only-item">บันทึกรายการ</button>
            </div>
        </div>

         <div class="ios-modal" id="individual-savings-modal">
            <div class="ios-modal-content full-screen">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="individual-savings-modal-title">รายการออมของ ...</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="individual-savings-list" class="divide-y divide-gray-100 overflow-y-auto" style="max-height: calc(90vh - 120px);">
                    </div>
            </div>
        </div>


        <div class="ios-modal" id="add-health-record-modal">
            <div class="ios-modal-content">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">บันทึกสุขภาพ (<span id="health-modal-class-name"></span>)</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="space-y-3">
                     <select id="health-student-select" class="ios-select w-full">
                        <option value="">เลือกนักเรียน...</option>
                        </select>
                    <input type="date" id="health-date-input" class="ios-input w-full">
                    <input type="number" id="health-weight-input" class="ios-input w-full" placeholder="น้ำหนัก (กก.)">
                    <input type="number" id="health-height-input" class="ios-input w-full" placeholder="ส่วนสูง (ซม.)">
                    <textarea id="health-notes-input" class="ios-input w-full h-24" placeholder="หมายเหตุเพิ่มเติม"></textarea>
                </div>
                <button id="save-new-health-record-btn" class="ios-button w-full mt-4 admin-only-item">บันทึกข้อมูลสุขภาพ</button>
            </div>
        </div>
        
        <div class="ios-modal" id="health-detail-modal"> <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="health-detail-modal-title">รายละเอียดสุขภาพ</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="health-detail-content" class="text-sm text-gray-700 space-y-2">
                    </div>
            </div>
        </div>

        <div class="ios-modal" id="ai-modal">
            <div class="ios-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="ai-modal-title">กำลังประมวลผล...</h3>
                    <button class="text-gray-500 close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="ai-modal-content-display" class="text-gray-700 text-sm leading-relaxed min-h-[100px]">
                    <div class="flex justify-center items-center py-8">
                        <div class="spinner mr-3"></div>
                        <span>กำลังสร้างข้อมูล...</span>
                    </div>
                </div>
            </div>
        </div>

    <div class="ios-modal" id="date-picker-modal">
        <div class="ios-modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">เลือกวันที่</h3>
                <button class="text-gray-500 close-modal-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="space-y-3">
                <input type="date" id="date-picker-input" class="ios-input w-full">
            </div>
            <button id="confirm-date-btn" class="ios-button w-full mt-4">ยืนยัน</button>
        </div>
    </div>

        <div class="fixed-nav-bar">
            <div class="nav-item active" data-page="attendance-page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="text-xs">เช็คชื่อ</span>
            </div>
            <div class="nav-item" data-page="savings-page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.75A.75.75 0 012.25 4.5h.75m0 0H3.75m-1.5 0H2.25m12.75 0H15V5.25A2.25 2.25 0 0012.75 3H12m0 0V2.25A2.25 2.25 0 009.75 0H7.5A2.25 2.25 0 005.25 2.25V3m4.5 0H12m-2.25 0H7.5M3 18.75V15m12.75 3.75V15M15 9l-3 3m0 0l-3-3m3 3V3.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="text-xs">ออมเงิน</span>
            </div>
            <div class="nav-item" data-page="health-page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                </svg>
                <span class="text-xs">สุขภาพ</span>
            </div>
            <div class="nav-item" data-page="profile-page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                </svg>
                <span class="text-xs">โปรไฟล์</span>
            </div>
        </div>
    </div>
</body>
</html>
